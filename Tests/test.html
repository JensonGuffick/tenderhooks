<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Version Display</title>
</head>
<body>
    <div id="version-number"></div>
    <script>
        // Function to fetch the token from token.txt
        async function fetchToken() {
            try {
                const response = await fetch('token.txt'); // Update the path as needed
                if (response.ok) {
                    const token = await response.text();
                    return token.trim(); // Remove any extra whitespace
                } else {
                    console.error('Failed to fetch token:', response.statusText);
                    return null;
                }
            } catch (error) {
                console.error('Error fetching token:', error);
                return null;
            }
        }

        // Function to fetch the deployment number from GitHub
        async function getDeploymentNumber(token) {
            const owner = 'Tenderhooks';  // Replace with the owner of the repo
            const repo = 'tenderhooks.github.io';    // Replace with the repo name

            const headers = {
                'Authorization': `token ${token}`,
                'Accept': 'application/vnd.github.v3+json'
            };

            try {
                const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/deployments`, { headers });
                if (response.ok) {
                    const deployments = await response.json();
                    if (deployments.length > 0) {
                        return deployments[0].id; // Assuming the deployment number is the ID of the latest deployment
                    } else {
                        console.error('No deployments found.');
                        return null;
                    }
                } else {
                    console.error('Failed to fetch deployments:', response.statusText);
                    return null;
                }
            } catch (error) {
                console.error('Error fetching deployments:', error);
                return null;
            }
        }

        function formatVersion(version) {
            const versionStr = version.toString().padStart(3, '0');
            const major = versionStr.charAt(0);
            const minor = versionStr.charAt(1);
            const patch = versionStr.charAt(2);
            return `${major}.${minor}.${patch}`;
        }

        async function updateVersion() {
            const token = await fetchToken();
            if (token) {
                const deploymentNumber = await getDeploymentNumber(token);
                if (deploymentNumber !== null) {
                    const formattedVersion = formatVersion(deploymentNumber);
                    document.getElementById('version-number').textContent = formattedVersion;
                }
            }
        }

        updateVersion();
    </script>
</body>
</html>
